<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æŒã¡ç‰©ç®¡ç†ã‚¢ãƒ—ãƒª </title>
  <style>
    :root { --primary-color: #4CAF50; --bg-color: #f4f7f6; }
    body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif; margin: 20px; background-color: var(--bg-color); color: #333; }
    .container { max-width: 950px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
    section { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 15px; }
    input, select, button { padding: 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; }
    input[type="date"] { font-family: inherit; }
    button { cursor: pointer; transition: 0.2s; background-color: #f0f0f0; border: 1px solid #ddd; }
    button:hover { background-color: #e8e8e8; }
    .primary-btn { background-color: var(--primary-color); color: white; border: none; font-weight: bold; }
    .primary-btn:hover { background-color: #45a049; }
    .summary-card { background: #e3f2fd; padding: 20px; border-radius: 10px; display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; border: 1px solid #bbdefb; }
    .summary-item { font-size: 1.05em; font-weight: bold; }
    .active { background-color: #333 !important; color: white !important; }
    .item { display: grid; grid-template-columns: 1fr auto auto; align-items: center;
      background: #fff; border: 1px solid #eee; padding: 15px; margin: 10px 0; border-radius: 8px; transition: transform 0.1s; }
    .item:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .info .title { font-weight: bold; font-size: 1.15em; color: #2c3e50; }
    .info .sub-text { font-size: 0.85em; color: #7f8c8d; margin-top: 4px; display: block; }
    .buy-info { font-size: 0.9em; text-align: right; margin-right: 20px; border-right: 1px solid #eee; padding-right: 20px; }
    .actions { display: flex; gap: 8px; }
    .edit-btn { background-color: #ff9800; color: white; border: none; padding: 8px 12px; }
    .del-btn { background-color: #f44336; color: white; border: none; padding: 8px 12px; }
  </style>
</head>
<body>

<div class="container">
  <h1>æŒã¡ç‰©ç®¡ç†ã‚¢ãƒ—ãƒª</h1>

  <section>
    <div id="summary" class="summary-card"></div>
    <div style="margin-bottom: 15px;">
      <strong>ä¸¦ã³æ›¿ãˆ:</strong>
      <button onclick="sortData('date', 'desc')">æ—¥ä»˜ãŒæ–°ã—ã„é †</button>
      <button onclick="sortData('date', 'asc')">æ—¥ä»˜ãŒå¤ã„é †</button>
      <button onclick="sortData('title', 'asc')">ã‚¿ã‚¤ãƒˆãƒ«é †</button>
    </div>
    <div class="filter-group" style="margin-bottom: 15px;">
      <strong>ç¨®åˆ¥:</strong>
      <button onclick="filterByType('all')" id="filter-all" class="active">ã™ã¹ã¦</button>
      <button onclick="filterByType('book')" id="filter-book">æœ¬</button>
      <button onclick="filterByType('cd')" id="filter-cd">CD</button>
      <button onclick="filterByType('record')" id="filter-record">ãƒ¬ã‚³ãƒ¼ãƒ‰</button>
    </div>
    <input type="text" id="searchBox" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢..." style="width: 250px;">
    <button id="searchBtn">æ¤œç´¢</button>
  </section>

  <section id="formSection">
    <h3 id="formTitle">æ–°ã—ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ </h3>
    <input type="hidden" id="editIndex" value="-1">
    <div class="form-grid">
      <select id="type">
        <option value="book">æœ¬</option>
        <option value="cd">CD</option>
        <option value="record">ãƒ¬ã‚³ãƒ¼ãƒ‰</option>
      </select>
      <input type="text" id="title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå¿…é ˆï¼‰">
      <input type="text" id="creator" placeholder="åˆ¶ä½œè€…ï¼ˆå¿…é ˆï¼‰">
      <input type="number" id="price" placeholder="ä¾¡æ ¼ï¼ˆå††ï¼‰">
      <input type="date" id="date">
      <input type="text" id="shop" placeholder="è³¼å…¥åº—å">
    </div>
    <button id="saveBtn" class="primary-btn" style="width: 150px;">ä¿å­˜ã™ã‚‹</button>
    <button id="cancelEditBtn" style="display:none;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
  </section>

  <section style="background: #fdfdfd; padding: 15px; border-radius: 8px;">
    <button onclick="exportJSON()">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆä¿å­˜ï¼‰</button>
    <button onclick="document.getElementById('importFile').click()">ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆå¾©å…ƒï¼‰</button>
    <input type="file" id="importFile" accept=".json" style="display:none;" onchange="importJSON(event)">
  </section>

  <h2>ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§</h2>
  <div id="list"></div>
</div>

<script>
let items = [];
let currentFilter = 'all';

const setToday = () => { document.getElementById('date').value = new Date().toISOString().slice(0, 10); };

window.onload = () => {
  const saved = localStorage.getItem('myCollectionUltimate');
  if (saved) items = JSON.parse(saved);
  setToday();
  renderList();
};

document.getElementById('saveBtn').onclick = function() {
  const type = document.getElementById('type').value;
  const title = document.getElementById('title').value.trim();
  const creator = document.getElementById('creator').value.trim();
  const price = parseInt(document.getElementById('price').value, 10) || 0;
  const date = document.getElementById('date').value;
  const shop = document.getElementById('shop').value.trim() || "ä¸æ˜";
  const editIndex = parseInt(document.getElementById('editIndex').value);

  if (!title || !creator) { alert("ã‚¿ã‚¤ãƒˆãƒ«ã¨åˆ¶ä½œè€…ã¯å¿…é ˆã§ã™"); return; }

  const newItem = { type, title, creator, price, date, shop };

  if (editIndex === -1) { items.push(newItem); } 
  else { items[editIndex] = newItem; resetForm(); }

  saveAndRender();
};

function editItem(index) {
  const item = items[index];
  document.getElementById('type').value = item.type;
  document.getElementById('title').value = item.title;
  document.getElementById('creator').value = item.creator;
  document.getElementById('price').value = item.price;
  document.getElementById('date').value = item.date;
  document.getElementById('shop').value = item.shop === "ä¸æ˜" ? "" : item.shop;
  document.getElementById('editIndex').value = index;
  
  document.getElementById('formTitle').innerText = "å†…å®¹ã‚’ä¿®æ­£ä¸­";
  document.getElementById('saveBtn').innerText = "æ›´æ–°ã™ã‚‹";
  document.getElementById('cancelEditBtn').style.display = "inline";
  window.scrollTo(0, document.getElementById('formSection').offsetTop - 20);
}

function resetForm() {
  document.getElementById('editIndex').value = "-1";
  document.getElementById('formTitle').innerText = "æ–°ã—ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ";
  document.getElementById('saveBtn').innerText = "ä¿å­˜ã™ã‚‹";
  document.getElementById('cancelEditBtn').style.display = "none";
  document.getElementById('title').value = "";
  document.getElementById('creator').value = "";
  document.getElementById('price').value = "";
  document.getElementById('shop').value = "";
  setToday();
}

document.getElementById('cancelEditBtn').onclick = resetForm;

function renderList(displayItems = items) {
  if (currentFilter !== 'all') displayItems = displayItems.filter(i => i.type === currentFilter);

  // çµ±è¨ˆè¨ˆç®—ï¼ˆå€‹æ•°ï¼‹ç¨®åˆ¥ã”ã¨ã®åˆè¨ˆé‡‘é¡ï¼‰
  const stats = items.reduce((acc, obj) => {
    acc.totalPrice += obj.price;
    acc[obj.type] = acc[obj.type] || { count: 0, sum: 0 };
    acc[obj.type].count += 1;
    acc[obj.type].sum += obj.price;
    return acc;
  }, { totalPrice: 0, book: {count:0,sum:0}, cd: {count:0,sum:0}, record: {count:0,sum:0} });

  document.getElementById('summary').innerHTML = `
    <div class="summary-item">ğŸ’° ç·è³‡ç”£: Â¥${stats.totalPrice.toLocaleString()}</div>
    <div class="summary-item">ğŸ“š æœ¬: ${stats.book.count}å†Š (Â¥${stats.book.sum.toLocaleString()})</div>
    <div class="summary-item">ğŸ’¿ CD: ${stats.cd.count}æš (Â¥${stats.cd.sum.toLocaleString()})</div>
    <div class="summary-item">ğŸ¸ ãƒ¬ã‚³ãƒ¼ãƒ‰: ${stats.record.count}æš (Â¥${stats.record.sum.toLocaleString()})</div>
  `;

  const listDiv = document.getElementById('list');
  listDiv.innerHTML = displayItems.length === 0 ? "<p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>" : "";
  
  const typeMap = { book:"æœ¬", cd:"CD", record:"ãƒ¬ã‚³ãƒ¼ãƒ‰" };

  displayItems.forEach((item) => {
    const trueIndex = items.indexOf(item); 
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <div class="info">
        <span class="title">[${typeMap[item.type]}] ${item.title}</span>
        <span class="sub-text">åˆ¶ä½œè€…: ${item.creator}</span>
      </div>
      <div class="buy-info">
        <div>ğŸ“… ${item.date}</div>
        <div style="color:#27ae60">ğŸ“ ${item.shop}</div>
        <div style="font-weight:bold; margin-top:4px;">Â¥${item.price.toLocaleString()}</div>
      </div>
      <div class="actions">
        <button class="edit-btn" onclick="editItem(${trueIndex})">ç·¨é›†</button>
        <button class="del-btn" onclick="deleteItem(${trueIndex})">å‰Šé™¤</button>
      </div>
    `;
    listDiv.appendChild(div);
  });
}

const sortData = (key, order) => {
  items.sort((a, b) => {
    let valA = a[key], valB = b[key];
    if (key === 'date') { valA = new Date(valA); valB = new Date(valB); }
    if (order === 'asc') return valA > valB ? 1 : -1;
    return valA < valB ? 1 : -1;
  });
  saveAndRender();
};

function filterByType(type) {
  currentFilter = type;
  document.querySelectorAll('.filter-group button').forEach(b => b.classList.remove('active'));
  document.getElementById('filter-' + type).classList.add('active');
  renderList();
}

function deleteItem(index) {
  if (confirm("ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
    items.splice(index, 1);
    saveAndRender();
  }
}

function saveAndRender() {
  localStorage.setItem('myCollectionUltimate', JSON.stringify(items));
  renderList();
}

function exportJSON() {
  const data = JSON.stringify(items, null, 2);
  const blob = new Blob([data], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `my_collection_${new Date().toISOString().slice(0,10)}.json`;
  a.click();
}

function importJSON(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      items = JSON.parse(e.target.result);
      saveAndRender();
      alert("ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ");
    } catch (err) { alert("æœ‰åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã‚ã‚Šã¾ã›ã‚“"); }
  };
  reader.readAsText(file);
}
</script>

</body>
</html>


















